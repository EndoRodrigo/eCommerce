<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragmentos/cabecera::cabecero-seccion}">

<body class="bg-gradient-primary">

    <div class="container">

        <!-- Outer Row -->
        <div class="row justify-content-center">

            <div class="col-xl-10 col-lg-12 col-md-9">

                <div class="glass-card my-5" style="border: none; box-shadow: var(--shadow-strong);">
                    <div class="card-body p-0">
                        <!-- Nested Row within Card Body -->
                        <div class="row">
                            <div class="col-lg-6 d-none d-lg-block" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.8) 0%, rgba(118, 75, 162, 0.8) 100%); display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden;">
                                <div style="text-align: center; color: white; z-index: 2;">
                                    <i class="fas fa-rocket fa-6x floating" style="margin-bottom: 20px; display: block;"></i>
                                    <h2 style="font-family: 'Orbitron', monospace; font-weight: 700; margin-bottom: 10px;">eCommerce PRO</h2>
                                    <p style="font-size: 1.1rem; opacity: 0.9;">Welcome to the future of eCommerce management</p>
                                </div>
                                <!-- Animated background elements -->
                                <div style="position: absolute; top: 20%; left: 20%; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%; animation: floating 4s ease-in-out infinite;"></div>
                                <div style="position: absolute; top: 60%; right: 20%; width: 60px; height: 60px; background: rgba(255,255,255,0.1); border-radius: 50%; animation: floating 3s ease-in-out infinite reverse;"></div>
                                <div style="position: absolute; bottom: 20%; left: 50%; width: 80px; height: 80px; background: rgba(255,255,255,0.1); border-radius: 50%; animation: floating 5s ease-in-out infinite;"></div>
                            </div>
                            <div class="col-lg-6">
                                <div class="p-5">
                                    <div class="text-center">
                                        <h1 class="h4 mb-4" style="font-family: 'Orbitron', monospace; font-weight: 700; background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Welcome Back!</h1>
                                    </div>
                                    
                                    <!-- SECURE LOGIN FORM -->
                                    <form class="user" th:action="@{/login}" method="post" th:object="${formUser}" id="secureLoginForm">
                                        <!-- CSRF Protection -->
                                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                                        <div class="form-group">
                                            <input type="email" 
                                                   class="form-control-modern"
                                                   id="username" 
                                                   name="username"
                                                   th:placeholder="'Enter Email Address...'"
                                                   th:value="*{username}"
                                                   required
                                                   autocomplete="username"
                                                   maxlength="100"
                                                   pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                                                   title="Please enter a valid email address">
                                            <div class="invalid-feedback" id="usernameError"></div>
                                        </div>
                                        
                                        <div class="form-group">
                                            <input type="password" 
                                                   class="form-control-modern"
                                                   id="password" 
                                                   name="password"
                                                   th:placeholder="'Password'"
                                                   required
                                                   autocomplete="current-password"
                                                   minlength="8"
                                                   maxlength="128">
                                            <div class="invalid-feedback" id="passwordError"></div>
                                        </div>
                                        
                                        <div class="form-group">
                                            <div class="custom-control custom-checkbox small">
                                                <input type="checkbox" 
                                                       class="custom-control-input" 
                                                       id="rememberMe"
                                                       name="remember-me">
                                                <label class="custom-control-label" for="rememberMe" style="color: var(--text-secondary);">
                                                    Remember Me
                                                </label>
                                            </div>
                                        </div>
                                        
                                        <!-- Rate Limiting and Bot Protection -->
                                        <div class="form-group" style="display: none;">
                                            <input type="text" name="honeypot" id="honeypot" tabindex="-1" autocomplete="off">
                                        </div>
                                        
                                        <button type="submit" 
                                                class="btn btn-modern btn-block animate-pulse"
                                                id="loginButton"
                                                data-loading-text="Authenticating...">
                                            Login
                                        </button>
                                        
                                        <!-- SECURITY: Error Messages (Sanitized) -->
                                        <div th:if="${param.error}" class="alert alert-danger mt-3" role="alert">
                                            <i class="fas fa-exclamation-triangle"></i>
                                            <span th:text="'Invalid credentials. Please try again.'"></span>
                                        </div>
                                        
                                        <div th:if="${param.logout}" class="alert alert-success mt-3" role="alert">
                                            <i class="fas fa-check-circle"></i>
                                            <span th:text="'You have been logged out successfully.'"></span>
                                        </div>
                                        
                                        <hr style="border-color: var(--glass-border);">
                                        
                                        <!-- SECURITY: Disabled external login for now (security concern) -->
                                        <div class="text-center">
                                            <p style="color: var(--text-muted); font-size: 0.9rem;">
                                                <i class="fas fa-shield-alt"></i> 
                                                External login temporarily disabled for security
                                            </p>
                                        </div>
                                    </form>
                                    
                                    <hr style="border-color: var(--glass-border);">
                                    <div class="text-center">
                                        <a class="small" th:href="@{/forgot-password}" style="color: var(--text-secondary); text-decoration: none;">Forgot Password?</a>
                                    </div>
                                    <div class="text-center">
                                        <a class="small" th:href="@{/register}" style="color: var(--text-secondary); text-decoration: none;">Create an Account!</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div>

    </div>

    <!-- Bootstrap core JavaScript - Local only for security -->
    <script th:src="@{/static/vendor/jquery/jquery.min.js}"></script>
    <script th:src="@{/static/vendor/bootstrap/js/bootstrap.bundle.min.js}"></script>

    <!-- Core plugin JavaScript -->
    <script th:src="@{/static/vendor/jquery-easing/jquery.easing.min.js}"></script>

    <!-- Custom scripts for all pages -->
    <script th:src="@{/static/js/sb-admin-2.min.js}"></script>
    
    <!-- SECURITY: Form Validation and Rate Limiting -->
    <script th:inline="javascript">
        // Secure login form handling
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('secureLoginForm');
            const loginButton = document.getElementById('loginButton');
            let attemptCount = 0;
            const maxAttempts = 5;
            const lockoutTime = 15 * 60 * 1000; // 15 minutes
            
            // Check if user is locked out
            const lockoutUntil = localStorage.getItem('loginLockout');
            if (lockoutUntil && Date.now() < parseInt(lockoutUntil)) {
                const remainingTime = Math.ceil((parseInt(lockoutUntil) - Date.now()) / 1000 / 60);
                alert(`Account temporarily locked. Please try again in ${remainingTime} minutes.`);
                form.style.display = 'none';
                return;
            }
            
            // Honeypot validation
            const honeypot = document.getElementById('honeypot');
            if (honeypot.value) {
                // Bot detected, silently fail
                return;
            }
            
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Rate limiting
                if (attemptCount >= maxAttempts) {
                    const lockoutTime = Date.now() + (15 * 60 * 1000);
                    localStorage.setItem('loginLockout', lockoutTime.toString());
                    alert('Too many login attempts. Account locked for 15 minutes.');
                    return;
                }
                
                // Input validation
                const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value;
                
                if (!username || !password) {
                    alert('Please fill in all fields.');
                    return;
                }
                
                // Email format validation
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(username)) {
                    alert('Please enter a valid email address.');
                    return;
                }
                
                // Password strength validation
                if (password.length < 8) {
                    alert('Password must be at least 8 characters long.');
                    return;
                }
                
                // Increment attempt counter
                attemptCount++;
                
                // Show loading state
                loginButton.disabled = true;
                loginButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Authenticating...';
                
                // Submit form securely
                setTimeout(() => {
                    form.submit();
                }, 1000); // Small delay to prevent rapid submissions
            });
            
            // Clear lockout on successful page load
            if (window.location.search.includes('logout')) {
                localStorage.removeItem('loginLockout');
                attemptCount = 0;
            }
        });
    </script>

</body>

</html>
</html>